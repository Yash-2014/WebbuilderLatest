<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultimate App Builder Wizard</title>
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338ca;
            --bg: #F3F4F6;
            --surface: #FFFFFF;
            --text-main: #111827;
            --text-sub: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --error: #EF4444;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* RESET & BASE */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text-main); padding-bottom: 90px; }
        
        /* HEADER */
        header { position: sticky; top: 0; background: var(--surface); padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); z-index: 50; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; font-size: 1.1rem; color: var(--primary); letter-spacing: -0.5px; }
        
        /* LANGUAGE TOGGLE */
        .toggle-switch { display: flex; background: var(--bg); padding: 3px; border-radius: 20px; border: 1px solid var(--border); }
        .toggle-opt { padding: 5px 12px; font-size: 0.75rem; font-weight: 600; border-radius: 16px; cursor: pointer; transition: 0.3s; color: var(--text-sub); }
        .toggle-opt.active { background: var(--primary); color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* PROGRESS BAR */
        .progress-wrap { position: fixed; top: 60px; left: 0; right: 0; z-index: 40; background: var(--bg); }
        .progress-track { height: 4px; background: var(--border); width: 100%; }
        .progress-fill { height: 100%; background: var(--primary); width: 20%; transition: width 0.4s ease; }
        .step-count { text-align: center; font-size: 0.75rem; color: var(--text-sub); padding: 4px 0; font-weight: 600; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); }

        /* CONTAINER */
        .container { max-width: 650px; margin: 24px auto 0; padding: 0 16px; }
        .step-section { display: none; animation: slideUp 0.4s ease-out; }
        .step-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS */
        .card { background: var(--surface); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .section-title { font-size: 1.1rem; font-weight: 700; color: var(--text-main); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--bg); display: flex; align-items: center; gap: 8px; }
        .sub-label { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 12px; display: block; font-weight: 500; }

        /* FORM ELEMENTS */
        .form-group { margin-bottom: 16px; }
        label { display: block; font-size: 0.9rem; margin-bottom: 6px; color: var(--text-main); font-weight: 500; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="url"], input[type="number"], select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg); transition: border 0.2s; -webkit-appearance: none;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        
        /* FILE UPLOAD */
        input[type="file"] { background: #fff; padding: 8px; font-size: 0.9rem; }

        /* MULTI-SELECT CHIPS */
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip { cursor: pointer; user-select: none; }
        .chip input { display: none; }
        .chip span { display: block; padding: 8px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 20px; font-size: 0.85rem; transition: 0.2s; color: var(--text-sub); }
        .chip input:checked + span { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: 600; box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3); }

        /* COLOR PICKER */
        .color-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; background: #fff; }
        .color-row label { margin: 0; font-size: 0.9rem; }
        input[type="color"] { width: 40px; height: 40px; padding: 0; border: none; border-radius: 50%; overflow: hidden; cursor: pointer; background: none; }

        /* BOTTOM NAVIGATION */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); padding: 12px 16px; display: flex; gap: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; border-top: 1px solid var(--border); }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-sec { background: var(--bg); color: var(--text-sub); border: 1px solid var(--border); }
        .btn-pri { background: var(--primary); color: #fff; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2); }
        .btn-pri:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* REVIEW TABLE */
        .review-group { margin-bottom: 15px; }
        .review-head { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-sub); margin-bottom: 5px; font-weight: 700; }
        .review-val { font-size: 1rem; color: var(--text-main); font-weight: 500; word-break: break-word; }
        .review-list { list-style: none; padding: 0; }
        .review-list li { margin-bottom: 8px; border-bottom: 1px dashed var(--border); padding-bottom: 4px; display: flex; justify-content: space-between; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo">AppBuilder Pro</div>
        <div class="toggle-switch">
            <div class="toggle-opt active" onclick="setLang('en')">EN</div>
            <div class="toggle-opt" onclick="setLang('hi')">हिंदी</div>
        </div>
    </header>

    <!-- Progress -->
    <div class="progress-wrap">
        <div class="step-count" id="step-count">Step 1 of 5</div>
        <div class="progress-track">
            <div class="progress-fill" id="progress-bar"></div>
        </div>
    </div>

    <!-- MAIN FORM -->
    <div class="container">

        <!-- STEP 1: BASIC DETAILS -->
        <section id="step-1" class="step-section active">
            <div class="card">
                <div class="section-title" data-i18n="cat_info">Application Category</div>
                
                <!-- Level 1: Main Category -->
                <div class="form-group">
                    <label data-i18n="main_cat">Main Category</label>
                    <select id="mainCategory" onchange="populateSubCategories()">
                        <option value="" disabled selected>Select Category</option>
                    </select>
                </div>

                <!-- Level 2: Sub Category -->
                <div class="form-group">
                    <label data-i18n="sub_cat">Sub Category</label>
                    <select id="subCategory" onchange="populateMicroCategories()">
                        <option value="" disabled selected>Select Main Category First</option>
                    </select>
                </div>

                <!-- Level 3: Micro Category -->
                <div class="form-group" id="microCatContainer">
                    <label>Micro Category (Specific Type)</label>
                    <select id="microCategory" onchange="checkCustomOption()">
                        <option value="" disabled selected>Select Sub Category First</option>
                    </select>
                </div>

                <!-- Custom Input (Hidden by default) -->
                <div class="form-group hidden" id="customCatDiv">
                    <label>Specify Custom Business Name</label>
                    <input type="text" id="customCatInput" placeholder="Enter Business Name (e.g., Pottery Shop)...">
                </div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="app_details">App Details</div>
                
                <div class="form-group">
                    <label data-i18n="app_type">App Type</label>
                    <select id="appType">
                        <option value="Mobile Web App">Mobile Web App (Mobile-Only)</option>
                        <option value="PWA">Progressive Web App (PWA)</option>
                        <option value="App-like Web">App-like Web Experience</option>
                        <option value="SPA">Single Page Mobile App (SPA)</option>
                        <option value="Offline-First">Offline-First Mobile App</option>
                    </select>
                </div>

                <div class="form-group">
                    <label data-i18n="curr">Default Currency</label>
                    <select id="currency">
                        <option value="INR">INR (₹)</option>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="target_aud">Target Audience (Multi-Select)</div>
                <div class="chip-container" id="audience-container"></div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="lang_sup">Language Support (Multi-Select)</div>
                <div class="chip-container">
                    <label class="chip"><input type="checkbox" name="lang_sup" value="English" checked><span>English</span></label>
                    <label class="chip"><input type="checkbox" name="lang_sup" value="Hindi"><span>Hindi</span></label>
                </div>
            </div>
        </section>

        <!-- STEP 2: PERSONAL / OWNER DETAILS -->
        <section id="step-2" class="step-section">
            <div class="card">
                <div class="section-title" data-i18n="identity">Identity</div>
                <div class="form-group"><label>Owner Name</label><input type="text" id="ownerName"></div>
                <div class="form-group"><label>Brand Name</label><input type="text" id="brandName"></div>
                <div class="form-group"><label>Company Name</label><input type="text" id="companyName"></div>
                <div class="form-group"><label>Founder Name</label><input type="text" id="founderName"></div>
                <div class="form-group"><label>Co-Founder (Optional)</label><input type="text" id="coFounder"></div>
                <div class="form-group"><label>Director (Optional)</label><input type="text" id="director"></div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="contact">Contact & Address</div>
                <div class="form-group"><label>Email</label><input type="email" id="email"></div>
                <div class="form-group"><label>Mobile</label><input type="tel" id="mobile"></div>
                <div class="form-group"><label>WhatsApp</label><input type="tel" id="whatsapp"></div>
                
                <hr style="border:0; border-top:1px dashed var(--border); margin:15px 0;">
                
                <div class="form-group"><label>Address Line 1</label><input type="text" id="addr1"></div>
                <div class="form-group"><label>City</label><input type="text" id="city"></div>
                <div class="form-group"><label>State</label><input type="text" id="state"></div>
                <div class="form-group"><label>PIN Code</label><input type="number" id="pincode"></div>
                <div class="form-group"><label>Google Map URL</label><input type="url" id="mapUrl"></div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="legal">Legal & Social</div>
                <div class="form-group"><label>PAN No</label><input type="text" id="pan"></div>
                <div class="form-group"><label>GST No (Optional)</label><input type="text" id="gst"></div>
                
                <label style="margin-top:10px;">Company Type</label>
                <div class="chip-container">
                    <label class="chip"><input type="radio" name="compType" value="Proprietor" checked><span>Proprietor</span></label>
                    <label class="chip"><input type="radio" name="compType" value="Partnership"><span>Partnership</span></label>
                    <label class="chip"><input type="radio" name="compType" value="Pvt Ltd"><span>Pvt Ltd</span></label>
                    <label class="chip"><input type="radio" name="compType" value="LLP"><span>LLP</span></label>
                    <label class="chip"><input type="radio" name="compType" value="NGO"><span>NGO</span></label>
                </div>

                <div style="margin-top:15px;">
                    <label>Website URL</label><input type="url" id="website" placeholder="https://">
                    <label style="margin-top:10px">Instagram URL</label><input type="url" id="insta" placeholder="https://instagram.com/">
                </div>
            </div>
        </section>

        <!-- STEP 3: BRANDING & UI -->
        <section id="step-3" class="step-section">
            <div class="card">
                <div class="section-title" data-i18n="assets">Branding Assets</div>
                <div class="form-group"><label>Logo Upload</label><input type="file" id="logoFile" accept="image/*"></div>
                <div class="form-group"><label>App Icon</label><input type="file" id="iconFile" accept="image/*"></div>
                <div class="form-group"><label>Tagline</label><input type="text" id="tagline"></div>
                <div class="form-group">
                    <label>App Name Display</label>
                    <select id="appNameDisplay">
                        <option value="Text">Text Only</option>
                        <option value="Logo">Logo Only</option>
                        <option value="Both">Both</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="colors">Brand Colors</div>
                <div class="color-row"><label>Primary</label><input type="color" id="colPrimary" value="#4F46E5"></div>
                <div class="color-row"><label>Secondary</label><input type="color" id="colSecondary" value="#6B7280"></div>
                <div class="color-row"><label>Accent</label><input type="color" id="colAccent" value="#F59E0B"></div>
                <div class="color-row"><label>Background</label><input type="color" id="colBg" value="#F3F4F6"></div>
                <div class="color-row"><label>Surface</label><input type="color" id="colSurface" value="#FFFFFF"></div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="typography">Typography</div>
                <div class="form-group">
                    <label>Font Style</label>
                    <select id="fontStyle">
                        <option value="Modern">Modern</option>
                        <option value="Classic">Classic</option>
                        <option value="Minimal">Minimal</option>
                        <option value="Tech">Tech</option>
                        <option value="Corporate">Corporate</option>
                        <option value="Handwritten">Handwritten</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Font Family</label>
                    <select id="fontFamily">
                        <option value="Sans-serif">Sans-serif</option>
                        <option value="Serif">Serif</option>
                        <option value="Monospace">Monospace</option>
                        <option value="Rounded">Rounded</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="ui_struct">UI Structure</div>
                <div class="form-group">
                    <label>Theme Mode</label>
                    <select id="themeMode">
                        <option value="Light">Light Mode</option>
                        <option value="Dark">Dark Mode</option>
                        <option value="Auto">Auto (System)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Layout Type</label>
                    <select id="layoutType">
                        <option value="Card">Card Layout</option>
                        <option value="List">List Layout</option>
                        <option value="Grid">Grid Layout</option>
                        <option value="Masonry">Masonry</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Navigation Style</label>
                    <select id="navStyle">
                        <option value="Bottom Bar">Bottom Navigation Bar</option>
                        <option value="Side Drawer">Side Drawer</option>
                        <option value="Tabs">Top Tabs</option>
                        <option value="FAB">Floating Action Button</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Button Style</label>
                    <select id="btnStyle">
                        <option value="Rounded">Rounded</option>
                        <option value="Sharp">Sharp Square</option>
                        <option value="Pill">Pill (Capsule)</option>
                        <option value="Gradient">Gradient</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="section-title">Animations (Multi-Select)</div>
                <div class="chip-container">
                    <label class="chip"><input type="checkbox" name="anim" value="Fade"><span>Fade In/Out</span></label>
                    <label class="chip"><input type="checkbox" name="anim" value="Slide"><span>Slide</span></label>
                    <label class="chip"><input type="checkbox" name="anim" value="Zoom"><span>Zoom</span></label>
                    <label class="chip"><input type="checkbox" name="anim" value="Micro"><span>Micro-interactions</span></label>
                    <label class="chip"><input type="checkbox" name="anim" value="Scroll"><span>Scroll FX</span></label>
                </div>
            </div>
        </section>

        <!-- STEP 4: PURPOSE & GOALS -->
        <section id="step-4" class="step-section">
            <div class="card">
                <div class="section-title" data-i18n="purpose">Primary Purpose</div>
                <div class="form-group">
                    <select id="primaryPurpose">
                        <option value="Sell Products">Sell Products</option>
                        <option value="Digital Products">Sell Digital Products</option>
                        <option value="Book Services">Book Services</option>
                        <option value="Appointments">Book Appointments</option>
                        <option value="Information">Share Information</option>
                        <option value="Community">Community Building</option>
                        <option value="Portfolio">Portfolio Display</option>
                        <option value="Education">Education / LMS</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="section-title" data-i18n="goals">Business Goals (Multi-Select)</div>
                <div class="chip-container" id="goals-container">
                    <!-- Populated via JS -->
                </div>
            </div>
        </section>

        <!-- STEP 5: FINAL REVIEW -->
        <section id="step-5" class="step-section">
            <div class="card" style="text-align: center; border-color: var(--primary);">
                <h2 style="margin:0; color:var(--primary);">Review Application</h2>
                <p style="color:var(--text-sub); margin-top:5px; font-size:0.9rem;">Please verify your details before building.</p>
            </div>
            
            <div id="review-content">
                <!-- Dynamic Review Generated Here -->
            </div>
        </section>

    </div>

    <!-- BOTTOM NAV -->
    <div class="nav-bar">
        <button class="btn btn-sec" id="btn-back" onclick="changeStep(-1)" disabled>Back</button>
        <button class="btn btn-pri" id="btn-next" onclick="changeStep(1)">Next Step</button>
        <button class="btn btn-pri hidden" id="btn-finish" onclick="finishBuild()">BUILD APP</button>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 3-LEVEL CATEGORY DATA STRUCTURE (UPDATED) ---
        const categoryData = {
            "Business": {
                "Local Business (Service-Based)": [
                    "Electrician", "Plumber", "Carpenter", "Painter", "Mason", "Welder", "Fabricator",
                    "Interior Worker", "CCTV Installer", "RO Service", "AC Repair", "Fridge Repair",
                    "Washing Machine Repair", "Computer Repair", "Laptop Repair", "Mobile Repair",
                    "Printer Repair", "IT Support Shop", "Data Recovery Shop", "Salon", "Barber Shop",
                    "Beauty Parlour", "Spa", "Tailor Shop", "Boutique", "Laundry", "Dry Cleaners",
                    "Cyber Cafe", "Internet Cafe", "CSC Center", "Common Service Center", "Aadhaar Center",
                    "PAN Center", "Digital Service Center", "Website Service Shop", "Documentation Center",
                    "Typing Center", "Photo Studio", "Printing Press", "Lamination Shop", "Xerox Shop",
                    "Coaching Center", "Tuition Center", "Training Center", "Skill Center",
                    "Real Estate Broker", "Property Dealer", "Construction Contractor", "Architect Office",
                    "Interior Designer Office", "Surveyor Office", "Valuation Office", "Advocate Office",
                    "CA Office", "Legal Consultant", "Tax Consultant", "Consultancy Office",
                    "Insurance Agent Office", "Loan Agent Office", "Finance Agent Office", "Car Garage",
                    "Bike Repair Shop", "Car Wash", "Transport Office", "Truck Booking Office",
                    "Tempo Service", "Packers & Movers", "Courier Shop", "Courier Franchise",
                    "Delivery Hub", "Logistics Office", "Warehouse Point", "Distribution Point",
                    "Lodge", "Guest House", "Homestay", "PG", "Hostel", "Security Service",
                    "Franchise Outlet", "Business Complex Office", "Consultancy Firm",
                    "Other Services Office", "Others"
                ],
                "Retail Business (Product-Based)": [
                    "Grocery Shop", "Kirana Store", "Mini Mart", "Convenience Store", "Department Store",
                    "Supermarket", "Hypermarket", "Vegetable Shop", "Fruit Shop", "Meat Shop", "Fish Market",
                    "Dairy", "Bakery", "Sweet Shop", "Medical Store", "Pharmacy", "Mobile Shop",
                    "Electronics Shop", "Computer Shop", "Laptop Store", "Accessories Store",
                    "Hardware Shop", "Electrical Store", "Plumbing Material Store", "Paint Store",
                    "Clothing Store", "Boutique Store", "Shoe Store", "Watch Shop", "Optical Store",
                    "Stationery Shop", "Book Shop", "Gift Shop", "Florist", "Pet Shop", "Aquarium Shop",
                    "Cycle Shop", "Tyre Shop", "Auto Parts Shop", "Fuel Station", "Fast Food Shop",
                    "Juice Center", "Tea Stall", "Street Food Vendor", "Cafe", "Small Restaurant", "Dhaba",
                    "Retail Outlet", "Franchise Outlet", "Local Mall", "Shopping Complex",
                    "Business Complex", "Super Store", "Others"
                ],
                "Corporate & Profile": [
                    "Local Business Website", "Corporate Profile Website", "SME / MSME Profile", 
                    "Startup Landing Website", "Franchise Info Website", "Retail Shop Profile", 
                    "Wholesale Business Profile", "Trading Company Profile", "Manufacturing Unit Profile", 
                    "Factory Profile", "Warehouse Profile", "Logistics Profile Page", "Supply Chain Info Portal", 
                    "Distribution Network Profile", "Import Export Company Profile", "B2B Profile Website", 
                    "B2C Profile Website", "Consultancy Website", "IT Company Profile", "Software Company Profile", 
                    "Tech Company Profile", "Digital Agency Website", "Marketing Agency Website", 
                    "Branding Agency Website", "Advertising Agency Website", "Media Company Website", 
                    "PR Agency Website", "Construction Company Profile", "Real Estate Info Website", 
                    "Architecture Firm Website", "Interior Design Firm Website", "Legal Firm Profile", 
                    "CA Firm Profile", "Accounting Firm Profile", "HR Consultancy Website", 
                    "Recruitment Agency Website", "Staffing Company Profile", "Event Management Website", 
                    "Travel Agency Website", "Tourism Info Website", "Transport Company Profile"
                ]
            },
            "Ecommerce": {
                "Catalog & Store Mode": [
                    "Product Catalog Store", "Static Ecommerce Store", "Digital Product Catalog", 
                    "Local Product Listing Store", "Grocery Catalog", "Fashion Catalog", 
                    "Electronics Catalog", "Mobile Store Catalog", "Furniture Catalog", 
                    "Home Decor Catalog", "Beauty Catalog", "Cosmetic Catalog", "Jewelry Catalog", 
                    "Footwear Catalog", "Sports Catalog", "Fitness Catalog", "Automobile Catalog", 
                    "Accessories Catalog", "Book Catalog", "Stationery Catalog", "Gift Catalog", 
                    "Handicraft Catalog", "Organic Product Catalog", "Wholesale Catalog", 
                    "B2B Catalog", "D2C Product Showcase"
                ]
            },
            "Education": {
                "Informational & LMS": [
                    "School Website", "College Website", "University Website", "Coaching Center Website", 
                    "Tuition Center Website", "Training Institute Website", "Skill Center Website", 
                    "IT Training Website", "Coding Academy Website", "Language Institute Website", 
                    "Online Course Catalog", "E-learning Static Platform", "LMS Demo Platform", 
                    "Exam Prep Info Portal", "Certification Course Website", "EdTech Info Platform"
                ]
            },
            "Healthcare": {
                "Info & Directory": [
                    "Hospital Website", "Clinic Website", "Diagnostic Center Website", "Pathology Lab Website", 
                    "Pharmacy Website", "Medical Store Website", "Telemedicine Info Portal", 
                    "Home Healthcare Info Site", "Dental Clinic Website", "Eye Clinic Website", 
                    "Skin Clinic Website", "Physiotherapy Website", "Rehab Center Website", 
                    "Mental Health Awareness Site", "Ayurveda Website", "Homeopathy Website", 
                    "Yoga Website", "Wellness Website", "Medical Tourism Website", "Ambulance Info Portal"
                ]
            },
            "Finance": {
                "Info & Tools UI": [
                    "Banking Info Website", "FinTech Info Website", "Loan Info Portal", 
                    "Insurance Info Website", "Investment Info Website", "Mutual Fund Info Portal", 
                    "Stock Market Info Website", "Wealth Management Profile", "Tax Consultancy Website", 
                    "Accounting Info Website", "Billing Tool UI", "Invoicing Tool UI", 
                    "Payroll Tool UI", "Credit Info Platform", "KYC Info Platform"
                ]
            },
            "Service": {
                "Listing Platforms": [
                    "Home Services Portal", "Repair Services Website", "Maintenance Services Website", 
                    "Cleaning Services Website", "Pest Control Website", "Plumbing Services Website", 
                    "Electrical Services Website", "Carpentry Services Website", "Painting Services Website", 
                    "Appliance Repair Website", "IT Services Website", "Web Development Website", 
                    "App Development Website", "Digital Marketing Website", "SEO Services Website", 
                    "Cloud Services Website", "Hosting Services Website", "Security Services Website", 
                    "Automation Services Website", "Event Services Website", "Legal Services Website", 
                    "Consultancy Services Website", "Freelance Services Website"
                ]
            },
            "Portfolio": {
                "Personal & Professional": [
                    "Personal Portfolio", "Freelancer Portfolio", "Designer Portfolio", "UI/UX Portfolio", 
                    "Developer Portfolio", "Photographer Portfolio", "Videographer Portfolio", 
                    "Artist Portfolio", "Animator Portfolio", "Architect Portfolio", 
                    "Interior Designer Portfolio", "Fashion Designer Portfolio", "Model Portfolio", 
                    "Actor Portfolio", "Musician Portfolio", "Writer Portfolio", 
                    "Influencer Portfolio", "Agency Portfolio", "Studio Portfolio"
                ]
            },
            "Booking": {
                "UI Simulation": [
                    "Appointment Booking UI", "Doctor Booking UI", "Salon Booking UI", "Spa Booking UI", 
                    "Gym Booking UI", "Trainer Booking UI", "Consultant Booking UI", "Tutor Booking UI", 
                    "Event Booking UI", "Ticket Booking UI", "Hotel Booking UI", "Resort Booking UI", 
                    "Car Rental UI", "Bike Rental UI", "Cab Booking UI", "Home Service Booking UI"
                ]
            },
            "NGO": {
                "Organizations": [
                    "NGO Website", "Charity Website", "Trust Website", "Foundation Website", 
                    "Education NGO Website", "Healthcare NGO Website", "Women NGO Website", 
                    "Child Welfare Website", "Environment NGO Website", "Animal Welfare Website", 
                    "Disaster Relief Website", "Human Rights Website"
                ]
            },
            "Startup": {
                "Types": [
                    "Startup Landing Page", "Product Startup Website", "Tech Startup Website", 
                    "SaaS Startup Website", "AI Startup Website", "EdTech Startup Website", 
                    "FinTech Startup Website", "HealthTech Startup Website", 
                    "AgriTech Startup Website", "GreenTech Startup Website"
                ]
            },
            "Community": {
                "Groups & Forums": [
                    "Community Website", "Social Community Portal", "Student Community Website", 
                    "Developer Community Website", "Startup Community Website", "Founder Community Website", 
                    "Creator Community Website", "Fitness Community Website", "Health Community Website", 
                    "Spiritual Community Website", "Alumni Community Website", "Local Community Website"
                ]
            },
            "News": {
                "Portals": [
                    "News Portal Website", "Blog News Website", "City News Website", "Local News Website", 
                    "Tech News Website", "Business News Website", "Sports News Website", 
                    "Entertainment News Website", "Education News Website", "Health News Website"
                ]
            },
            "Entertainment": {
                "Media & Fun": [
                    "Movie Info Website", "OTT Info Website", "Web Series Website", "Music Artist Website", 
                    "Album Website", "Event Website", "Standup Comedy Website", "Theatre Website", 
                    "Dance Website", "Gaming Website", "Esports Website", "Podcast Website", 
                    "Radio Website", "Fan Community Website", "Influencer Website"
                ]
            },
            "SaaS": {
                "UI Demos": [
                    "CRM Demo UI", "ERP Demo UI", "HRMS Demo UI", "Payroll Demo UI", 
                    "Accounting Demo UI", "Billing Demo UI", "Invoicing Demo UI", 
                    "Project Management UI", "Task Management UI", "Productivity Tools UI", 
                    "Collaboration Tools UI", "Chatbot UI", "AI Tool UI", 
                    "No-Code Builder UI", "Low-Code Builder UI"
                ]
            },
            "Personal": {
                "Sites & Blogs": [
                    "Personal Website", "Personal Blog", "Resume Website", "CV Website", 
                    "Personal Brand Website", "Influencer Website", "Creator Website", 
                    "Artist Website", "Author Website", "Speaker Website", "Coach Website", 
                    "Consultant Website", "Freelancer Website", "Developer Website", 
                    "Designer Website", "Photographer Website", "Model Website", 
                    "Actor Website", "Musician Website", "Fitness Trainer Website", 
                    "Yoga Trainer Website", "Life Coach Website", "Motivational Speaker Website"
                ]
            }
        };

        const audienceList = [
            "Students", "Teachers", "Customers", "Clients", "Businesses", "Professionals", 
            "Doctors", "Engineers", "Freelancers", "Vendors", "Sellers", "Buyers", 
            "Agents", "Distributors", "Public Users", "Internal Staff", "Managers", "Investors"
        ];

        const businessGoals = [
            "Branding", "Sales", "Growth", "Engagement", "Automation", "Support", 
            "Retention", "Expansion", "Market Capture", "Lead Conversion", "Cost Reduction"
        ];

        const translations = {
            en: {
                cat_info: "Application Category", main_cat: "Main Category", sub_cat: "Sub Category",
                app_details: "App Details", app_type: "App Type", curr: "Default Currency",
                target_aud: "Target Audience", lang_sup: "Language Support",
                identity: "Identity", contact: "Contact & Address", legal: "Legal & Social",
                assets: "Branding Assets", colors: "Brand Colors", typography: "Typography",
                ui_struct: "UI Structure", purpose: "Primary Purpose", goals: "Business Goals",
                next: "Next Step", back: "Back", finish: "BUILD APP"
            },
            hi: {
                cat_info: "एप्लिकेशन श्रेणी", main_cat: "मुख्य श्रेणी", sub_cat: "उप श्रेणी",
                app_details: "ऐप विवरण", app_type: "ऐप का प्रकार", curr: "डिफ़ॉल्ट मुद्रा",
                target_aud: "लक्षित दर्शक", lang_sup: "भाषा समर्थन",
                identity: "पहचान", contact: "संपर्क और पता", legal: "कानूनी और सामाजिक",
                assets: "ब्रांडिंग एसेट्स", colors: "ब्रांड रंग", typography: "टाइपोग्राफी",
                ui_struct: "UI संरचना", purpose: "मुख्य उद्देश्य", goals: "व्यापार लक्ष्य",
                next: "अगला चरण", back: "वापस", finish: "ऐप बनाओ"
            }
        };

        // --- STATE MANAGEMENT ---
        let currentStep = 1;
        const totalSteps = 5;
        let currentLang = 'en';

        // --- INITIALIZATION ---
        window.onload = function() {
            initCategories();
            initMultiSelect('audience-container', audienceList, 'audience');
            initMultiSelect('goals-container', businessGoals, 'goal');
        };

        function initCategories() {
            const select = document.getElementById('mainCategory');
            for (let cat in categoryData) {
                let opt = document.createElement('option');
                opt.value = cat;
                opt.innerText = cat;
                select.appendChild(opt);
            }
        }

        // --- 3-LEVEL LOGIC ---
        function populateSubCategories() {
            const main = document.getElementById('mainCategory').value;
            const sub = document.getElementById('subCategory');
            const micro = document.getElementById('microCategory');
            
            // Reset Sub & Micro
            sub.innerHTML = '<option value="" disabled selected>Select Sub Category</option>';
            micro.innerHTML = '<option value="" disabled selected>Select Sub Category First</option>';
            document.getElementById('customCatDiv').classList.add('hidden');

            if (categoryData[main]) {
                const subCats = Object.keys(categoryData[main]);
                subCats.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item;
                    opt.innerText = item;
                    sub.appendChild(opt);
                });
            }
        }

        function populateMicroCategories() {
            const main = document.getElementById('mainCategory').value;
            const sub = document.getElementById('subCategory').value;
            const micro = document.getElementById('microCategory');

            // Reset Micro
            micro.innerHTML = '<option value="" disabled selected>Select Specific Type</option>';
            document.getElementById('customCatDiv').classList.add('hidden');

            if (categoryData[main] && categoryData[main][sub]) {
                const microCats = categoryData[main][sub];
                microCats.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item;
                    opt.innerText = item;
                    micro.appendChild(opt);
                });
            }
        }

        // Function to handle "Others" (Custom Input)
        function checkCustomOption() {
            const micro = document.getElementById('microCategory').value;
            const customDiv = document.getElementById('customCatDiv');

            if(micro === 'Others') {
                customDiv.classList.remove('hidden');
            } else {
                customDiv.classList.add('hidden');
            }
        }

        function initMultiSelect(containerId, list, nameAttr) {
            const container = document.getElementById(containerId);
            list.forEach(item => {
                let label = document.createElement('label');
                label.className = 'chip';
                label.innerHTML = `<input type="checkbox" name="${nameAttr}" value="${item}"><span>${item}</span>`;
                container.appendChild(label);
            });
        }

        // --- NAVIGATION ---
        function changeStep(n) {
            if (n === 1 && !validateStep(currentStep)) return;

            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep += n;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            window.scrollTo(0, 0);

            document.getElementById('btn-back').disabled = (currentStep === 1);
            
            const nextBtn = document.getElementById('btn-next');
            const finishBtn = document.getElementById('btn-finish');

            if (currentStep === totalSteps) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');
                generateReview();
            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
            }
            updateProgress();
        }

        function updateProgress() {
            const pct = (currentStep / totalSteps) * 100;
            document.getElementById('progress-bar').style.width = pct + '%';
            document.getElementById('step-count').innerText = `Step ${currentStep} of ${totalSteps}`;
        }

        function validateStep(step) {
            if(step === 1) {
                const main = document.getElementById('mainCategory').value;
                const sub = document.getElementById('subCategory').value;
                const micro = document.getElementById('microCategory').value;
                if(!main || !sub || !micro) { alert("Please complete all category selections."); return false; }
            }
            if(step === 2) {
                const name = document.getElementById('ownerName').value;
                const mobile = document.getElementById('mobile').value;
                if(!name || !mobile) { alert("Owner Name and Mobile are required."); return false; }
            }
            return true;
        }

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.toggle-opt').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(translations[lang][key]) el.innerText = translations[lang][key];
            });
            document.getElementById('btn-next').innerText = translations[lang]['next'];
            document.getElementById('btn-back').innerText = translations[lang]['back'];
            document.getElementById('btn-finish').innerText = translations[lang]['finish'];
        }

        function getCheckedValues(name) {
            return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
                        .map(cb => cb.value).join(', ');
        }

        function generateReview() {
            const container = document.getElementById('review-content');
            container.innerHTML = '';

            const main = document.getElementById('mainCategory').value;
            const sub = document.getElementById('subCategory').value;
            const micro = document.getElementById('microCategory').value;
            
            let finalType = micro;
            if(micro === 'Others') {
                finalType = document.getElementById('customCatInput').value || 'Custom Business';
            }

            const data = {
                "Category Path": `${main} > ${sub}`,
                "Business Type": finalType,
                "App Type": document.getElementById('appType').value,
                "Audience": getCheckedValues('audience') || 'None',
                "Languages": getCheckedValues('lang_sup'),
                "Currency": document.getElementById('currency').value,
                "Owner": document.getElementById('ownerName').value,
                "Company": document.getElementById('companyName').value || '-',
                "Mobile": document.getElementById('mobile').value,
                "Location": `${document.getElementById('city').value}, ${document.getElementById('state').value}`,
                "Brand Colors": `Primary: ${document.getElementById('colPrimary').value}`,
                "UI Theme": `${document.getElementById('themeMode').value} / ${document.getElementById('layoutType').value}`,
                "Purpose": document.getElementById('primaryPurpose').value,
                "Goals": getCheckedValues('goal')
            };

            for (let [key, val] of Object.entries(data)) {
                let div = document.createElement('div');
                div.className = 'card review-group';
                div.innerHTML = `
                    <div class="review-head">${key}</div>
                    <div class="review-val">${val}</div>
                `;
                container.appendChild(div);
            }
        }

        async function finishBuild() {
            // 1. Capture Data
            const brandName = document.getElementById('brandName').value || 'My Brand';
            const primaryColor = document.getElementById('colPrimary').value;
            const fontFamily = document.getElementById('fontFamily').value;
            const themeMode = document.getElementById('themeMode').value;
            const micro = document.getElementById('microCategory').value;
            let businessType = micro;
            if(micro === 'Others') {
                businessType = document.getElementById('customCatInput').value || 'Custom Business';
            }

            // 2. Define CSS Variables logic (derived from user selection)
            const bg = themeMode === 'Dark' ? '#111827' : '#F9FAFB';
            const surface = themeMode === 'Dark' ? '#1F2937' : '#FFFFFF';
            const text = themeMode === 'Dark' ? '#F3F4F6' : '#111827';
            const textSub = themeMode === 'Dark' ? '#9CA3AF' : '#6B7280';
            const border = themeMode === 'Dark' ? '#374151' : '#E5E7EB';

            // 3. Confirm Action
            if(!confirm(`Ready to launch your ${brandName} app with Builder Engine?`)) return;

            // 4. Update UI to show loading
            const btn = document.getElementById('btn-finish');
            const originalText = btn.innerText;
            btn.innerText = "Fetching Resources...";
            btn.disabled = true;

            // 5. Define Files to Fetch
            const fileList = [
                'builder_part1.html',
                'builder_part2.html',
                'builder_part3.html',
                'builder_part4.html',
                'builder_final.html'
            ];

            try {
                // Fetch all files in parallel
                const responses = await Promise.all(fileList.map(url => fetch(url)));

                // Check for errors (e.g. 404 Not Found)
                for (const res of responses) {
                    if (!res.ok) throw new Error(`Could not load ${res.url}. Ensure files exist.`);
                }

                // Get text content from responses
                const fileContents = await Promise.all(responses.map(res => res.text()));

                // Combine them into one string
                let rawHTML = fileContents.join('\n');

                // 6. Template Replacement
                // Replaces placeholders like ${brandName} within the fetched HTML files
                // with the actual values derived from the wizard.
                let generatedHTML = rawHTML
                    .replaceAll('${brandName}', brandName)
                    .replaceAll('${primaryColor}', primaryColor)
                    .replaceAll('${fontFamily}', fontFamily)
                    .replaceAll('${themeMode}', themeMode)
                    .replaceAll('${businessType}', businessType);

                // 7. Inject Dynamic CSS Variables
                // Since external files are static, we inject a style block to override root vars
                // based on the theme selection logic.
                const dynamicStyles = `
                    <style>
                        :root {
                            --primary: ${primaryColor};
                            --bg: ${bg};
                            --surface: ${surface};
                            --text: ${text};
                            --text-sub: ${textSub};
                            --border: ${border};
                            --radius: 12px;
                        }
                        body { font-family: '${fontFamily}', sans-serif; }
                    </style>
                `;

                // Append styles to the beginning of the generated HTML
                generatedHTML = dynamicStyles + generatedHTML;

                // 8. Render the new application
                document.open();
                document.write(generatedHTML);
                document.close();

            } catch (err) {
                console.error(err);
                alert("Error loading builder files. \n\nIMPORTANT: Because this uses 'fetch', you must run this on a local server (like Live Server or localhost), not directly via file:// path.\n\nError Details: " + err.message);
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
